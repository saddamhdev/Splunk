Perfect üëåüî•
Below is a **clean, structured documentation** for setting up **Splunk HTTP Event Collector (HEC)** in your environment (Docker + Spring Boot).

This is written like real technical documentation you can reuse.

---

# üìò Splunk HTTP Event Collector (HEC) Setup Guide

---

# 1Ô∏è‚É£ What is HEC?

**HTTP Event Collector (HEC)** allows applications to send data directly to Splunk via HTTP/HTTPS.

Instead of:

```text
App ‚Üí Log File ‚Üí Splunk Monitor
```

You use:

```text
App ‚Üí HTTP POST ‚Üí Splunk (HEC)
```

Benefits:

* No file mounting
* Real-time ingestion
* Works across servers
* Ideal for microservices & Kubernetes
* Enterprise-grade ingestion method

---

# 2Ô∏è‚É£ Prerequisites

### ‚úÖ Splunk running in Docker

Example:

```bash
docker run -d \
  --name splunk \
  -p 3060:8000 \
  -p 8088:8088 \
  -p 8089:8089 \
  -e SPLUNK_START_ARGS=--accept-license \
  -e SPLUNK_PASSWORD=YourPassword \
  -e SPLUNK_GENERAL_TERMS=--accept-sgt-current-at-splunk-com \
  splunk/splunk:latest
```

### Important Ports

| Port | Purpose       |
| ---- | ------------- |
| 8000 | Web UI        |
| 8088 | HEC ingestion |
| 8089 | REST API      |

---

# 3Ô∏è‚É£ Enable HEC in Splunk UI

### Step 1 ‚Äî Open Splunk

```
http://localhost:3060
```

Login as:

```
admin / YourPassword
```

---

### Step 2 ‚Äî Go To:

```
Settings ‚Üí Data Inputs ‚Üí HTTP Event Collector
```

Click:

```
New Token
```

---

### Step 3 ‚Äî Configure Token

* Name: `spring-hec-token`
* Index: `main`
* Leave defaults

‚ö† Disable **Indexer Acknowledgment** for simple development.

Finish.

---

### Step 4 ‚Äî Copy Token

You will receive something like:

```
a22e99ae-51de-4bff-8567-a726b83760d6
```

Save this token securely.

---

# 4Ô∏è‚É£ Test HEC Using curl

```bash
curl -k https://localhost:8088/services/collector \
  -H "Authorization: Splunk YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"event":"hello from spring"}'
```

Expected response:

```json
{"text":"Success","code":0}
```

---

# 5Ô∏è‚É£ Event Format

Basic event:

```json
{
  "event": "hello world"
}
```

Structured event (recommended):

```json
{
  "time": 1700000000,
  "host": "gateway-service",
  "source": "spring-app",
  "sourcetype": "_json",
  "event": {
    "service": "gateway-service",
    "level": "INFO",
    "traceId": "abc123",
    "correlationId": "xyz789",
    "message": "Gateway started"
  }
}
```

---

# 6Ô∏è‚É£ Verify Data in Splunk

Go to:

```
Search & Reporting
```

Run:

```spl
index=main
```

Or:

```spl
service="gateway-service"
```

---

# 7Ô∏è‚É£ Spring Boot Integration

## Option A ‚Äî Manual HTTP Call

```java
String url = "https://localhost:8088/services/collector";

HttpHeaders headers = new HttpHeaders();
headers.set("Authorization", "Splunk YOUR_TOKEN");
headers.setContentType(MediaType.APPLICATION_JSON);

String body = """
{
  "event": {
    "service": "gateway-service",
    "level": "INFO",
    "message": "Gateway started"
  }
}
""";

restTemplate.postForEntity(url, new HttpEntity<>(body, headers), String.class);
```

---

## Option B ‚Äî Logback Appender (Automatic)

Use Splunk Java logging library to automatically push logs.

(Recommended for production.)

---

# 8Ô∏è‚É£ HEC Security

### Development

* `-k` curl (ignore SSL)
* Self-signed certificate

### Production

* Use valid TLS certificate
* Use token authentication
* Restrict network access
* Enable indexer acknowledgment if needed

---

# 9Ô∏è‚É£ Troubleshooting

### ‚ùå `Data channel is missing`

Cause:

* Indexer acknowledgment enabled
* Missing `X-Splunk-Request-Channel` header

Fix:

* Disable acknowledgment
  OR
* Add channel header

---

### ‚ùå `401 Unauthorized`

Cause:

* Wrong token

Fix:

* Check token value
* Ensure HEC enabled globally

---

### ‚ùå No events in UI

Check:

```spl
index=main
```

Also verify:

* Correct index selected during token creation
* Time range (Last 24 hours)

---

# üîü Architecture Diagram

```
Spring Boot Microservices
        ‚Üì
JSON Structured Log
        ‚Üì
HTTP POST (Port 8088)
        ‚Üì
Splunk Index
        ‚Üì
Search / Alert / Dashboard
```

---

# 1Ô∏è‚É£1Ô∏è‚É£ Best Practices

* Use structured JSON
* Include traceId & correlationId
* Use separate index per environment (dev, uat, prod)
* Monitor ingestion errors
* Rotate HEC tokens periodically

---

# üéØ When To Use HEC

| Use Case           | Use HEC? |
| ------------------ | -------- |
| Local dev          | Optional |
| Microservices      | ‚úÖ Yes    |
| Kubernetes         | ‚úÖ Yes    |
| Distributed system | ‚úÖ Yes    |
| Enterprise logging | ‚úÖ Yes    |

---

# üî• Final Result

With HEC enabled, you now have:

‚úî Real-time ingestion
‚úî Centralized logging
‚úî No file dependency
‚úî Microservice-ready observability
‚úî Scalable architecture

---

If you want next, I can provide:

* Production-grade Spring Boot HEC auto-logging config
* Full Logback XML for HEC
* Async high-performance sender
* Secure TLS configuration guide
* Splunk dashboard + alert setup guide

Just tell me üëå
